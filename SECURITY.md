# Политика безопасности FinGuru

Этот документ описывает меры безопасности, реализованные в проекте для соответствия требованиям банковских сервисов.

## Реализованные меры безопасности

### 1. Валидация входных данных

- **Валидация всех пользовательских входов** через Pydantic схемы
- **Санitизация строк** для предотвращения инъекций
- **Проверка форматов** (client_id, bank_code, даты, периоды)
- **Ограничение длины** входных данных
- **Валидация диапазонов** (проценты, даты)

### 2. Защита от атак

#### Rate Limiting
- Ограничение запросов: **60 запросов в минуту** на IP-адрес
- Защита от DDoS и brute-force атак

#### Security Headers
- `X-Content-Type-Options: nosniff` - защита от MIME-sniffing
- `X-Frame-Options: DENY` - защита от clickjacking
- `X-XSS-Protection: 1; mode=block` - защита от XSS
- `Strict-Transport-Security` - принудительное использование HTTPS
- `Content-Security-Policy` - ограничение источников контента
- `Referrer-Policy` - контроль передачи referrer

### 3. Безопасное логирование

- **Маскирование чувствительных данных** в логах:
  - Токены (access_token, bank_token)
  - Секреты (client_secret)
  - Пароли
  - Consent IDs
- **JSON формат логов** для структурированного анализа
- **Отсутствие логирования** полных токенов и секретов

### 4. CORS и доступ

- **Ограниченные origins** в production
- **Разрешенные методы**: только GET и POST
- **Ограниченные заголовки**: Content-Type, Authorization
- **Отключение Swagger UI** в production

### 5. Обработка ошибок

- **Обобщенные сообщения об ошибках** - не раскрывают внутреннюю структуру
- **Безопасные сообщения** для аутентификации (не раскрывают причину отказа)
- **Логирование ошибок** без чувствительных данных

### 6. Хранение секретов

- **Переменные окружения** для всех секретов
- **Исключение .env файлов** из git
- **Шифрование токенов** в памяти (при необходимости)
- **Автоматическое истечение** токенов

### 7. Валидация данных

#### Client ID
- Только alphanumeric + дефисы/подчеркивания
- Максимальная длина: 100 символов
- Обязательная проверка формата

#### Bank Code
- Только разрешенные значения: vbank, abank, sbank
- Приведение к нижнему регистру
- Валидация на всех эндпоинтах

#### Даты
- ISO формат обязателен
- Проверка диапазонов
- Валидация логики (from_date < to_date)

#### Проценты
- Диапазон: 0-100
- Валидация типов

### 8. Сетевая безопасность

- **HTTPS только** для production
- **Таймауты** для всех HTTP запросов (15 секунд)
- **Валидация SSL сертификатов** (по умолчанию в httpx)

### 9. Защита от инъекций

- **Параметризованные запросы** (Pydantic валидация)
- **Санitизация строк** перед использованием
- **Валидация типов** на всех уровнях

### 10. Мониторинг и аудит

- **Структурированное логирование** всех операций
- **Отслеживание запросов** с маскированием чувствительных данных
- **Health checks** для мониторинга состояния

## Рекомендации для production

1. **Настройте production origins** в CORS
2. **Используйте HTTPS** с валидным SSL сертификатом
3. **Настройте rate limiting** в зависимости от нагрузки
4. **Используйте внешний сервис** для rate limiting (Redis)
5. **Реализуйте аутентификацию** для API (OAuth2, JWT)
6. **Добавьте мониторинг** и алертинг
7. **Регулярно обновляйте** зависимости
8. **Используйте WAF** (Web Application Firewall)
9. **Настройте backup** и disaster recovery
10. **Проведите security audit** перед запуском

## Соответствие стандартам

Проект следует лучшим практикам:
- **OWASP Top 10** - защита от основных уязвимостей
- **PCI DSS** - базовые требования для работы с финансовыми данными
- **GDPR** - защита персональных данных (при необходимости)

## Контакты для сообщений о безопасности

Если вы обнаружили уязвимость, пожалуйста, сообщите об этом ответственно.

